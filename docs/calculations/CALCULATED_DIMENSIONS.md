# Calculated Dimensions Reference

This document lists all dimensions that are **calculated** (not generated by LLM) in the visualization system, along with their calculation methods.

---

## Core Spatial Dimensions (XYZ Coordinates)

### 1. **X-Axis: Communication Function** (Functional ↔ Social)
**Location:** `src/utils/conversationToTerrain.ts` → `getCommunicationFunction()`

**Calculation Method:**
- **Primary:** Linguistic marker analysis via `calculateFunctionalSocialScore()`
  - Analyzes message content for task-oriented vs. social/expressive language
  - Functional markers: task imperatives (`write`, `create`, `fix`), goal language, technical terms
  - Social markers: personal pronouns (`I`, `my`), emotional language, social niceties, expressive language
  - Formula: `socialScore / (functionalScore + socialScore)` → 0 = functional, 1 = social
  
- **Fallback (if messages unavailable):**
  1. Role-based: Maps human role distribution to X position
     - `challenger` → 0.1, `seeker` → 0.4, `collaborator` → 0.7, `sharer` → 0.95
  2. Purpose-based: Maps conversation purpose
     - `entertainment/relationship-building/self-expression` → 0.7-0.9
     - `information-seeking/problem-solving` → 0.1-0.3
  3. Knowledge exchange-based: Maps knowledge type
     - `personal-sharing/experience-sharing` → 0.6
     - `factual-info/skill-sharing` → 0.3

**Range:** 0.0 (Functional) to 1.0 (Social)

---

### 2. **Y-Axis: Linguistic Alignment** (Convergent ↔ Divergent)
**Location:** `src/utils/conversationToTerrain.ts` → `getConversationStructure()`

**Calculation Method:**
- **Primary:** Linguistic alignment analysis via `calculateConversationAlignment()`
  - Extracts 7 linguistic features from human vs. LLM messages:
    - Formality, Politeness, Certainty, Structure, Question-asking, Inclusive language, Register
  - Calculates cosine similarity between human and LLM feature vectors
  - Formula: `y_value = 1 - cosineSimilarity(humanFeatures, llmFeatures)`
  - High similarity = convergent (low Y), Low similarity = divergent (high Y)
  
- **Fallback (if messages unavailable):**
  1. Role-based: Maps AI role distribution to stance
     - `expert/advisor` → 0.85-0.90 (directive)
     - `reflector/facilitator/peer` → 0.15-0.35 (supportive)
  2. Pattern-based: Maps interaction pattern
     - `collaborative/casual-chat/storytelling` → 0.2-0.4 (supportive)
     - `question-answer/advisory` → 0.7-0.9 (directive)
  3. Engagement-based: Maps engagement style
     - `exploring/questioning` → 0.3
     - `reactive/affirming` → 0.6

**Range:** 0.0 (Aligned/Convergent) to 1.0 (Divergent)

---

### 3. **Z-Axis: Emotional Intensity** (Calm ↔ Agitated)
**Location:** `src/utils/conversationToTerrain.ts` → `conversationToTerrain()` and `getTerrainParams()`

**Calculation Method:**
- **Primary:** Average of per-message PAD emotional intensity
  - If messages have PAD data: `avg(emotionalIntensity)` across all messages
  - Formula: `emotionalIntensity = (1 - pleasure) * 0.6 + arousal * 0.4`
  
- **Fallback:** Conversation-level PAD approximation from classification
  - Maps `emotionalTone` → Pleasure (P)
    - `playful/supportive/empathetic` → 0.8 (high pleasure)
    - `serious/neutral+challenging` → 0.2 (low pleasure)
    - Default → 0.5
  - Maps `engagementStyle` → Arousal (A)
    - `challenging/questioning` → 0.8 (high arousal)
    - `reactive` → 0.3 (low arousal)
    - Default → 0.5
  - Formula: `emotionalIntensity = (1 - pleasure) * 0.6 + arousal * 0.4`

**Range:** 0.0 (Calm/Affiliation) to 1.0 (Agitated/Frustration)

---

## PAD (Pleasure-Arousal-Dominance) Scores

### 4. **Pleasure (P)**
**Location:** `src/utils/conversationToTerrain.ts` → `calculateMessagePAD()`

**Calculation Method:**
- **Base value:** From conversation-level `emotionalTone`
  - `playful/supportive/empathetic` → 0.8
  - `serious` → 0.3
  - `neutral` → 0.5
  
- **Message-level adjustments:**
  - Frustration markers (`wrong`, `error`, `failed`, `not working`) → -0.25
  - Satisfaction markers (`perfect`, `thanks`, `exactly`, `works perfectly`) → +0.25
  - Clamped to [0, 1]

**Range:** 0.0 (Low Pleasure) to 1.0 (High Pleasure)

---

### 5. **Arousal (A)**
**Location:** `src/utils/conversationToTerrain.ts` → `calculateMessagePAD()`

**Calculation Method:**
- **Base value:** From conversation-level `engagementStyle`
  - `questioning` → 0.7 (high arousal)
  - `reactive` → 0.3 (low arousal)
  - `affirming` → 0.45 (moderate-low)
  - `exploring` → 0.6 (moderate-high)
  
- **Message-level adjustments:**
  - Frustration markers → +0.25
  - Satisfaction markers → -0.15
  - Urgency markers (`urgent`, `asap`, `help`, `quickly`) → +0.2
  - Clamped to [0, 1]

**Range:** 0.0 (Low Arousal) to 1.0 (High Arousal)

---

### 6. **Dominance (D)** (Directive-ness)
**Location:** `src/utils/conversationToTerrain.ts` → `calculateMessagePAD()`

**Calculation Method:**
- **Message structure analysis:**
  - Questions (`?`) → 0.3 (low directive-ness, seeking)
  - Commands/requests (`please`, `can you`, `write`, `create`, `make`) → 0.7 (high directive-ness)
  - Statements → 0.5 (moderate)
  
- **Note:** This measures directive-ness (command/request vs. question), not social dominance in the PAD literature sense. The label "Dominance" is used for consistency with PAD terminology, but the heuristic is pragmatic.
- **No conversation-level base** (message-specific only)

**Range:** 0.0 (Low Directive-ness) to 1.0 (High Directive-ness)

---

### 7. **Emotional Intensity** (Derived from PAD)
**Location:** `src/utils/conversationToTerrain.ts` → `calculateMessagePAD()`

**Calculation Method:**
- **Formula:** `emotionalIntensity = (1 - pleasure) * 0.6 + arousal * 0.4`
- **Interpretation:**
  - High intensity = Low Pleasure (frustration) + High Arousal (agitation) = **Peaks**
  - Low intensity = High Pleasure (affiliation) + Low Arousal (calm) = **Valleys**
- Used for Z-axis height in 3D visualization

**Range:** 0.0 (Valley/Affiliation) to 1.0 (Peak/Frustration)

---

## Path Generation Dimensions

### 8. **Message X Position** (Path Drift)
**Location:** `src/utils/terrain.ts` → `generatePathPoints()`

**Calculation Method:**
- **Cumulative drift from origin (0.5, 0.5):**
  - Base drift: `(targetX - 0.5) * 1.2 * lengthScale`
  - Message drift: `(expressiveScore - 0.5) * 0.5 * lengthScale`
  - Role drift: User → -0.06, Assistant → +0.06
  - Progressive factor: Increases with conversation progress
  - Formula: `currentX += (targetDriftX + messageDriftX + roleDriftX) * driftFactor`
  - Clamped to [0.03, 0.97] (or [0.05, 0.95] for shorter conversations)

**Range:** 0.0 to 1.0 (normalized terrain coordinates)

---

### 9. **Message Y Position** (Path Drift)
**Location:** `src/utils/terrain.ts` → `generatePathPoints()`

**Calculation Method:**
- **Cumulative drift from origin (0.5, 0.5):**
  - Base drift: `(targetY - 0.5) * 1.2 * lengthScale`
  - Message drift: `(alignmentScore - 0.5) * 0.5 * lengthScale`
  - Role drift: User → +0.06, Assistant → -0.06
  - Progressive factor: Increases with conversation progress
  - Formula: `currentY += (targetDriftY + messageDriftY + roleDriftY) * driftFactor`
  - Clamped to [0.03, 0.97] (or [0.05, 0.95] for shorter conversations)

**Range:** 0.0 to 1.0 (normalized terrain coordinates)

---

### 10. **Message Z Position (Height)**
**Location:** `src/components/ThreeScene.tsx` → `createMarkerGroup()`

**Calculation Method:**
- **Priority 1:** PAD emotional intensity
  - `yPosition = pad.emotionalIntensity * terrainHeight`
- **Priority 2:** PAD height (fallback)
  - `yPosition = padHeight * terrainHeight`
- **Priority 3:** Terrain height (last resort)
  - `yPosition = height * terrainHeight`
- Plus offset: `+ MARKER_CONFIG.PATH_Y_OFFSET + terrainPosition.y`

**Range:** 0.0 to `terrainHeight` (typically 8.0 units)

---

## Terrain Generation Dimensions

### 11. **Terrain Seed**
**Location:** `src/utils/conversationToTerrain.ts` → `generateSeedFromClassification()`

**Calculation Method:**
- **Hash-based deterministic seed:**
  - Input: `pattern-tone-purpose-conversationId`
  - Hash algorithm: Simple string hash (shift-left + add)
  - Output: `Math.abs(hash % 999) + 1` → Range 1-999
- **Fallback:** Conversation ID hash if no classification

**Range:** 1 to 999

---

### 12. **Average Confidence**
**Location:** `src/utils/conversationToTerrain.ts` → `getTerrainParams()`

**Calculation Method:**
- **Average across 9 classification dimensions:**
  - `interactionPattern.confidence`
  - `powerDynamics.confidence`
  - `emotionalTone.confidence`
  - `engagementStyle.confidence`
  - `knowledgeExchange.confidence`
  - `conversationPurpose.confidence`
  - `turnTaking.confidence`
  - `humanRole.confidence`
  - `aiRole.confidence`
- Formula: `sum(confidences) / count(confidences)`
- Clamped to [0.3, 1.0]

**Range:** 0.3 to 1.0

---

## Linguistic Feature Dimensions

### 13. **Formality** (0 = informal, 1 = formal)
**Location:** `src/utils/linguisticMarkers.ts` → `extractLinguisticFeatures()`

**Calculation Method:**
- Counts formal markers: `thus`, `therefore`, `utilize`, `facilitate`, `via`, `per`
- Counts informal markers: `yeah`, `gonna`, `wanna`, `cool`, `lol`, contractions
- Formula: `(formalCount / wordCount * 0.01) - (informalCount / wordCount * 0.02)`
- Clamped to [0, 1]

---

### 14. **Politeness** (0 = none, 1 = many)
**Calculation Method:**
- Counts politeness markers: `please`, `thank you`, `would you`, `I apologize`, `sorry`
- Formula: `politenessCount / (wordCount * 0.02)`
- Clamped to [0, 1]

---

### 15. **Certainty** (0 = uncertain, 1 = certain)
**Calculation Method:**
- Counts uncertainty: `maybe`, `perhaps`, `I think`, `I'm not sure`
- Counts certainty: `definitely`, `certainly`, `always`, `must`, `certain`
- Formula: `certaintyCount / (uncertaintyCount + certaintyCount)`
- Clamped to [0, 1]

---

### 16. **Structure** (0 = loose, 1 = structured)
**Calculation Method:**
- Counts structure markers: `first/second/third`, `step 1`, lists, `in conclusion`
- Average sentence length (longer = more structured)
- Formula: `(structureCount / sentenceCount * 0.1) + (avgSentenceLength > 15 ? 0.2 : 0)`
- Clamped to [0, 1]

---

### 17. **Question-Asking** (0 = none, 1 = many)
**Calculation Method:**
- Counts question marks: `?`
- Formula: `questionCount / sentenceCount`
- Clamped to [0, 1]

---

### 18. **Inclusive Language** (0 = none, 1 = extensive)
**Calculation Method:**
- Counts inclusive markers: `we`, `let's`, `together`, `our`, `collaboratively`, `team`
- Formula: `inclusiveCount / (wordCount * 0.01)`
- Clamped to [0, 1]

---

### 19. **Register** (0 = casual, 1 = formal/professional)
**Calculation Method:**
- Combination: `formality * 0.4 + politeness * 0.3 + structure * 0.2 + (1 - contractionRatio) * 0.1`
- Clamped to [0, 1]

---

## Path Statistics Dimensions

### 20. **Total Distance Traveled**
**Location:** `src/pages/MultiPathViewPage.tsx` → `calculatePathStats()`

**Calculation Method:**
- Sum of 3D Euclidean distances between consecutive path points
- Formula: `√((x₂-x₁)² + (y₂-y₁)² + (z₂-z₁)²)` for each segment
- Summed across all segments

---

### 21. **Elevation Statistics** (Min/Max/Avg)
**Calculation Method:**
- Min: `Math.min(...elevations)` where elevations = `emotionalIntensity` or `height`
- Max: `Math.max(...elevations)`
- Avg: `sum(elevations) / count(elevations)`

---

## Dimensions NOT Calculated (LLM-Generated)

These dimensions are **generated by LLM classifiers**, not calculated:

1. **Interaction Pattern** (question-answer, advisory, storytelling, etc.)
2. **Power Dynamics** (human-led, ai-led, balanced, alternating)
3. **Emotional Tone** (playful, serious, neutral, supportive, empathetic)
4. **Engagement Style** (questioning, affirming, exploring, reactive, challenging)
5. **Knowledge Exchange** (factual-info, personal-sharing, skill-sharing, etc.)
6. **Conversation Purpose** (information-seeking, problem-solving, entertainment, etc.)
7. **Topic Depth** (surface, moderate, deep)
8. **Turn Taking** (user-dominant, assistant-dominant, balanced)
9. **Human Role Distribution** (seeker, learner, director, collaborator, sharer, challenger)
10. **AI Role Distribution** (expert, advisor, facilitator, reflector, peer, affiliative)

These are stored in `conversation.classification` and come from the classifier output.

---

## Summary

**Primary Calculated Dimensions (19):**
- **3 Core spatial axes:** X (Communication Function), Y (Linguistic Alignment), Z (Emotional Intensity)
- **4 PAD scores:** Pleasure (P), Arousal (A), Dominance (D), Emotional Intensity (derived)
- **3 Path coordinates per message:** X, Y, Z positions (cumulative drift from origin)
- **7 Linguistic features:** Formality, Politeness, Certainty, Structure, Question-asking, Inclusive language, Register
- **1 Terrain seed:** Hash-based deterministic seed
- **1 Average confidence:** Mean of 9 classification confidence scores

**Derived Aggregates (not counted as separate dimensions):**
- Path statistics: Total distance traveled, Elevation min/max/avg (3 values)
- Average PAD values: Average Pleasure, Arousal, Dominance, Emotional Intensity (4 values)

**Counting Convention:**
Only "primary" dimensions are counted—those that are directly calculated from source data. Aggregates (averages, min/max, totals) are derived from primary dimensions and not counted separately.

**LLM-Generated Dimensions (10):**
- All stored in `classification` object
- Generated during classification process
- Not recalculated in frontend

